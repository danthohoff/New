# --- Fallback: nächste Fläche in 25832 (metrisch) ---
# Punkte-Indizes ohne Treffer ermitteln (einmalig, eindeutig)
missing_idx = joined.index[joined["netzbezirk"].isna()].unique()

if len(missing_idx) > 0:
    print("Fallback (nearest in EPSG:25832) für", int(len(missing_idx)), "Punkte …")

    # in metrisches CRS
    pts_32  = pts.to_crs(epsg=25832)
    poly_32 = netz_wgs.to_crs(epsg=25832)

    # nur die fehlenden Punkte nehmen (per Index, NICHT per Bool-Maske)
    pts_missing_32 = pts_32.loc[missing_idx]

    # nächstgelegenes Polygon suchen (vektorisiert, ohne Loops)
    nearest = gpd.sjoin_nearest(
        pts_missing_32,
        poly_32[["label", poly_32.geometry.name]],
        how="left",
        distance_col="dist_m"
    )

    # Ergebnis per Index zurückschreiben
    joined.loc[nearest.index, "netzbezirk"] = nearest["label"].values